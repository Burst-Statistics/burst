jQuery(document).ready((function(t){"use strict";function e(){t(".burst-experiment-start button").prop("disabled",!1),t(".burst-experiment-stop button").prop("disabled",!1),t(".burst_selected_experiment_id_wrapper select").prop("disabled",!1)}function a(){t(".burst-experiment-start button").prop("disabled",!0),t(".burst-experiment-stop button").prop("disabled",!0),t(".burst_selected_experiment_id_wrapper select").prop("disabled",!0)}function s(s,n){var i=void 0===s;s=void 0!==s?s:parseInt(t("input[name=burst_experiment_start]").val()),n=void 0!==n?n:parseInt(t("input[name=burst_experiment_end]").val()),a();window.config={type:"line",data:{labels:["...","...","...","...","...","...","..."],datasets:[{label:"Loading...",backgroundColor:"rgb(41, 182, 246)",borderColor:"rgb(41, 182, 246)",data:[0,0,0,0,0,0,0],fill:!1},{label:"Loading...",backgroundColor:"rgb(244, 191, 62)",borderColor:"rgb(244, 191, 62)",data:[0,0,0,0,0,0,0],fill:!1}]},options:{legend:{display:!0},responsive:!0,maintainAspectRatio:!1,title:{display:!1,text:"Select an experiment"},tooltips:{mode:"index",intersect:!0,enabled:!0,position:"nearest",callbacks:{label:function(t,e){var a="";"conversion_percentages"==d&&(a="%");var s=t.datasetIndex;return e.datasets[s].label+": "+t.yLabel+a}}},hover:{mode:"index",intersect:!0},scales:{xAxes:[{display:!1,offset:!0,scaleLabel:{display:!0,labelString:"Date"}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Loading..."},ticks:{beginAtZero:!0,min:0,max:10,stepSize:5}}]}}};var o=document.getElementsByClassName("burst-chartjs-stats");null!=window.conversionGraph&&window.conversionGraph.destroy(),window.conversionGraph=new Chart(o,window.config);var u=t("select[name=burst_selected_experiment_id]").val(),d=t("select[name=burst_selected_metric]").val();u>0&&t.ajax({type:"get",dataType:"json",url:burst.ajaxurl,data:{action:"burst_get_experiment_statistics",experiment_id:u,date_start:s,date_end:n,metric:d},success:function(a){if(1==a.success){console.log(a.data),i&&(t("input[name=burst_experiment_start]").val(a.data.date_start),t("input[name=burst_experiment_end]").val(a.data.date_end),r(moment.unix(a.data.date_start),moment.unix(a.data.date_end)));var s=0;a.data.datasets.forEach((function(t){if(window.config.data.datasets.hasOwnProperty(s))window.config.data.datasets[s]=t;else{var e=t;window.config.data.datasets.push(e)}s++})),window.config.data.labels=a.data.labels,window.config.options.title.text=a.title,window.config.options.scales.yAxes[0].ticks.max=parseInt(a.data.max),window.config.options.scales.yAxes[0].scaleLabel.labelString=a.options.scales.yAxes[0].scaleLabel,window.conversionGraph.update(),e()}else alert("Your experiment data could not be loaded")}})}function n(){var e=t("select[name=burst_selected_experiment_id]").val(),a=parseInt(t("input[name=burst_experiment_start]").val()),s=parseInt(t("input[name=burst_experiment_end]").val());t(".burst-load-ajax").each((function(){var n=t(this);0==n.find(".burst-skeleton").length&&n.find(".burst-grid-content").fadeOut(200,(function(){t(this).html('<div class="burst-skeleton"></div>').fadeIn(300)}));var r=n.data("table_type");t.ajax({type:"get",dataType:"json",url:burst.ajaxurl,data:{action:"burst_load_grid_block",experiment_id:e,date_start:a,date_end:s,type:r},success:function(e){e.success&&n.find(".burst-grid-content").fadeOut(300,(function(){t(this).html(e.html).fadeIn(200)}))}})}))}function r(e,a){t(".burst-date-container span").html(e.format("MMMM D, YYYY")+" - "+a.format("MMMM D, YYYY"))}function i(){var e=t("select[name=burst_selected_experiment_id]").val();0==t(".burst-experiment-status").find(".loading").length&&(t(".burst-experiment-status .burst-bullet").removeClass().addClass("burst-bullet grey loading"),t(".burst-experiment-status .burst-experiment-status__text").fadeOut(300,(function(){t(this).html("Loading...").fadeIn(200)})),t(".burst-experiment-stop").fadeOut(),t(".burst-experiment-completed").fadeOut(200)),t.ajax({type:"get",dataType:"json",url:burst.ajaxurl,data:{action:"burst_load_status_info",experiment_id:e},success:function(e){e.success&&(t(".burst-experiment-status .burst-bullet").removeClass().addClass("burst-bullet "+e.data.status.class),t(".burst-experiment-status .burst-experiment-status__text").fadeOut(300,(function(){t(this).html(e.data.status.title).fadeIn(200)})),t(".burst-experiment-stop").hide(),t(".burst-experiment-completed").hide(),"Active"===e.data.status.title?t(".burst-experiment-stop").show():"Completed"===e.data.status.title&&(t(".burst-experiment-completed-text").html(e.data.date_end_text),t(".burst-experiment-completed").show()))}})}t(document).on("click",".burst-dismiss-notice",(function(){var e=t(this).data("notice_id"),a=t(this);a.prop("disabled",!0),t.ajax({type:"POST",url:burst.ajaxurl,dataType:"json",data:{action:"burst_dismiss_notice",id:e},success:function(t){a.prop("disabled",!1),t.success&&a.closest(".burst-notice").remove()}})})),t(document).on("click",".burst-statistics-action",(function(){var s=t(this).data("experiment_action"),n=t("select[name=burst_selected_experiment_id]").val();a(),t.ajax({type:"POST",url:burst.ajaxurl,dataType:"json",data:{action:"burst_experiment_action",type:s,experiment_id:n,token:burst.token},success:function(a){a.success&&(e(),t(".burst-experiment-start").hide(),t(".burst-experiment-stop").hide(),"start"===s?t(".burst-experiment-stop").show():t(".burst-experiment-start").show())}})})),function(){var e=burstLocalizeString("Today"),a=(burstLocalizeString("Yesterday"),burstLocalizeString("Last 7 days")),n=burstLocalizeString("Last 30 days"),i=burstLocalizeString("This Month"),o=burstLocalizeString("Last Month"),u=burstLocalizeString("Experiment duration"),d={};d[e]=[b,m],d[a]=[x,g],d[n]=[moment().subtract(31,"days"),p],d[i]=[moment().startOf("month"),moment().endOf("month")],d[o]=[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")];var l=parseInt(t("input[name=burst_experiment_start]").val()),c=parseInt(t("input[name=burst_experiment_end]").val());null!==l&&null!==c||(l=moment().endOf("day").subtract(1,"week").unix(),c=moment().endOf("day").unix());l=parseInt(l),c=parseInt(c),d[u]=[moment.unix(l),moment.unix(c)],s();var b=moment().endOf("day").subtract(1,"days").add(1,"minutes"),m=moment().endOf("day"),p=(moment().endOf("day").subtract(2,"days").add(1,"minutes"),moment().endOf("day").subtract(1,"days")),x=moment().endOf("day").subtract(8,"days").add(1,"minutes"),g=moment().endOf("day").subtract(1,"days");t(".burst-date-container.burst-date-range").daterangepicker({ranges:d,locale:{format:burstLocalizeString("date_format","burst"),separator:" - ",applyLabel:burstLocalizeString("Apply","burst"),cancelLabel:burstLocalizeString("Cancel","burst"),fromLabel:burstLocalizeString("From","burst"),toLabel:burstLocalizeString("To","burst"),customRangeLabel:burstLocalizeString("Custom","burst"),weekLabel:burstLocalizeString("W","burst"),daysOfWeek:[burstLocalizeString("Mo","burst"),burstLocalizeString("Tu","burst"),burstLocalizeString("We","burst"),burstLocalizeString("Th","burst"),burstLocalizeString("Fr","burst"),burstLocalizeString("Sa","burst"),burstLocalizeString("Su","burst")],monthNames:[burstLocalizeString("January"),burstLocalizeString("February"),burstLocalizeString("March"),burstLocalizeString("April"),burstLocalizeString("May"),burstLocalizeString("June"),burstLocalizeString("July"),burstLocalizeString("August"),burstLocalizeString("September"),burstLocalizeString("October"),burstLocalizeString("November"),burstLocalizeString("December")],firstDay:1},alwaysShowCalendars:!0,startDate:moment.unix(l),endDate:moment.unix(c),opens:"left"},(function(t,e,a){r(t,e),s(t.unix(),e.unix())}))}(),t(document).on("change","select[name=burst_selected_experiment_id]",(function(){s(),n(),i()})),t(document).on("change","select[name=burst_selected_metric]",(function(){var e=t(".burst-date-container.burst-date-range").data("daterangepicker"),a=moment(e.startDate),n=moment(e.endDate);s(a.unix(),n.unix())})),n(),i()}));
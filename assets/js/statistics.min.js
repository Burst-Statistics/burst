jQuery(document).ready((function(t){"use strict";let a="Previous 7 days";function e(e,s){e=parseInt(t("input[name=burst_date_start]").val()),s=parseInt(t("input[name=burst_date_end]").val());let r=getComputedStyle(document.body),n=r.getPropertyValue("--rsp-blue"),i=r.getPropertyValue("--rsp-yellow"),o={type:"line",beginAtZero:!0,data:{datasets:[{label:"Pageviews",borderColor:n,backgroundColor:n},{label:"Visitors",borderColor:i,backgroundColor:i}]},options:{responsive:!0,maintainAspectRatio:!1,cubicInterpolationMode:"monotone",scales:{y:{ticks:{beginAtZero:!0,stepSize:1,maxTicksLimit:6}},x:{ticks:{maxTicksLimit:8}}}}},u=document.getElementsByClassName("burst-chartjs-stats");null!=window.insightsGraph&&window.insightsGraph.destroy(),window.insightsGraph=new Chart(u,o);let l=JSON.parse(t("input[name=burst_chartjs_metrics]").val());t.ajax({type:"get",dataType:"json",url:burst.ajaxurl,data:{action:"burst_get_chart_statistics",date_start:e,date_end:s,metrics:l,date_range:a},success:function(t){if(1==t.success){let a=0;t.data.datasets.forEach((function(t){if(o.data.datasets.hasOwnProperty(a))o.data.datasets[a]=t;else{let a=t;o.data.datasets.push(a)}a++})),o.data.labels=t.data.labels,o.data.dates=t.data.dates,window.insightsGraph.update()}else alert("Your data could not be loaded")},error:function(t){console.log(t)}})}function s(){t(".burst-load-ajax").each((function(){let e=t(this);e.find(".burst-skeleton").length&&e.find(".burst-grid-content").fadeOut(200,(function(){t(this).html('<div class="burst-skeleton"></div>').fadeIn(300)}));let s=e.data("block_type"),r=parseInt(t("input[name=burst_date_start]").val()),n=parseInt(t("input[name=burst_date_end]").val());t.ajax({type:"get",dataType:"json",url:burst.ajaxurl,data:{action:"burst_load_grid_block",type:s,date_start:r,date_end:n,date_range:a},success:function(a){a.success&&e.find(".burst-grid-content").fadeOut(300,(function(){t(this).html(a.html).fadeIn(200)}))}})}))}function r(a,e){t(".burst-date-container span").html(a.format("MMMM D, YYYY")+" - "+e.format("MMMM D, YYYY"))}!function(){let n=moment().endOf("day").subtract(2,"days").add(1,"minutes"),i=moment().endOf("day").subtract(1,"days"),o=burstLocalizeString("Yesterday"),u=burstLocalizeString("Previous 7 days"),l=burstLocalizeString("Previous 30 days"),d=burstLocalizeString("Previous 90 days"),b=burstLocalizeString("Previous Month")+" ("+moment().subtract(1,"month").format("MMMM")+")",c={};c[o]=[n,i],c[u]=[moment(i).subtract(6,"days").startOf("day"),i],c[l]=[moment(i).subtract(29,"days").startOf("day"),i],c[d]=[moment(i).subtract(89,"days").startOf("day"),i],c[b]=[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")];let g=moment(i).subtract(6,"days").startOf("day"),m=i;t(".burst-compare-days-number").html(Math.abs(g.diff(m,"days"))+1),r(g,m);let f=g.unix()+60*g.utcOffset(),p=m.unix()+60*m.utcOffset();t("input[name=burst_date_start]").val(f),t("input[name=burst_date_end]").val(p),s(),e(),t(".burst-date-container.burst-date-range").daterangepicker({ranges:c,locale:{format:burstLocalizeString("date_format","burst"),separator:" - ",applyLabel:burstLocalizeString("Apply","burst"),cancelLabel:burstLocalizeString("Cancel","burst"),fromLabel:burstLocalizeString("From","burst"),toLabel:burstLocalizeString("To","burst"),customRangeLabel:burstLocalizeString("Custom","burst"),weekLabel:burstLocalizeString("W","burst"),daysOfWeek:[burstLocalizeString("Su","burst"),burstLocalizeString("Mo","burst"),burstLocalizeString("Tu","burst"),burstLocalizeString("We","burst"),burstLocalizeString("Th","burst"),burstLocalizeString("Fr","burst"),burstLocalizeString("Sa","burst")],monthNames:[burstLocalizeString("January"),burstLocalizeString("February"),burstLocalizeString("March"),burstLocalizeString("April"),burstLocalizeString("May"),burstLocalizeString("June"),burstLocalizeString("July"),burstLocalizeString("August"),burstLocalizeString("September"),burstLocalizeString("October"),burstLocalizeString("November"),burstLocalizeString("December")],firstDay:1},alwaysShowCalendars:!0,startDate:g,endDate:m,opens:"left",maxDate:i},(function(n,i,o){a=burst_unLocalizeString(o),r(n,i);let u=n.unix()+60*n.utcOffset(),l=i.unix()+60*i.utcOffset();t("input[name=burst_date_start]").val(u),t("input[name=burst_date_end]").val(l),e(),t(".burst-compare-days-number").html(Math.abs(n.diff(i,"days"))+1),s(),window.burstLoadAjaxTables()}))}();let n=0;function i(e,s,r,o){1===r&&e.html(burst.skeleton);let u=parseInt(t("input[name=burst_date_start]").val()),l=parseInt(t("input[name=burst_date_end]").val()),d=e.data("block_type");t.ajax({type:"GET",url:burst.ajaxurl,dataType:"json",data:{action:"burst_get_datatable",start:u,end:l,page:r,type:d,date_range:a},success:function(a){if(console.log("response"),console.log(a),1===r){let r=e.find("table");e.find(".burst-skeleton").fadeOut(300,(function(){r.hide().html(a.html).fadeIn(200),r.DataTable().destroy(),e.find(".dataTables_filter").remove(),e.find(".dataTables_paginate").remove(),function(a,e){a.DataTable({id:e,pageLength:10,pagingType:"simple_numbers",conditionalPaging:!0,autoWidth:!0,info:!1,lengthChange:!1,language:{paginate:{previous:burstLocalizeString("Previous"),next:burstLocalizeString("Next")},searchPlaceholder:burstLocalizeString("Search"),search:"",emptyTable:burstLocalizeString("No data available")},order:[[1,"desc"]]}),a.on("page.dt",(function(){let a=t(this).closest("table").DataTable().page.info();n=a.page}))}(r,s),e.find(".dataTables_filter").appendTo(e.find(".burst-grid-controls")),e.find(".dataTables_paginate").appendTo(e.find(".burst-grid-footer"))}))}else{let s=e.find("table").DataTable(),r=a.html.length;for(let e in a.html)if(a.html.hasOwnProperty(e)){let i=t(a.html[e]);parseInt(e)>=r-1?(s.row.add(i).draw(),s.page(n).draw(!1)):s.row.add(i)}}o+=a.batch,a.total_rows>o?(r++,i(e,r,o)):r=1}})}t.fn.DataTable.ext.pager.numbers_length=5,t(window).on("resize",(function(){t(".burst-grid-container").each((function(){t(this).hasClass("burst-load-ajax-datatable")&&t(this).find("table").DataTable().columns.adjust().draw()}))})),window.burstLoadAjaxTables=function(){t(".burst-grid-datatable").each((function(){console.log("found datatable"),0==t(this).find(".burst-skeleton").length&&t(this).find(".burst-grid-content").fadeOut(200,(function(){t(this).html('<div class="burst-skeleton"></div>').fadeIn(300)})),i(t(this),t(this).data("id"),1,0)}))},window.burstLoadAjaxTables()}));
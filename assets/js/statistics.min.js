jQuery(document).ready((function(t){"use strict";let a="Last 7 days";function e(e,s){e=parseInt(t("input[name=burst_date_start]").val()),s=parseInt(t("input[name=burst_date_end]").val());let r=getComputedStyle(document.body),n=r.getPropertyValue("--rsp-yellow"),i=r.getPropertyValue("--rsp-blue"),o=(r.getPropertyValue("--rsp-text-color"),[]);Chart.defaults.font.size=12,Chart.defaults.color=r.getPropertyValue("--rsp-text-color");let l={type:"line",beginAtZero:!0,data:{datasets:[{label:burstLocalizeString("Unique visitors"),borderColor:i,backgroundColor:i},{label:burstLocalizeString("Pageviews"),borderColor:n,backgroundColor:n}]},options:{responsive:!0,maintainAspectRatio:!1,cubicInterpolationMode:"monotone",plugins:{legend:{labels:{usePointStyle:!0,padding:15,font:{size:13,weight:400}}},tooltip:{callbacks:{title:function(t){return o.dates[t[0].dataIndex]}}}},scales:{y:{ticks:{beginAtZero:!0,stepSize:1,maxTicksLimit:6}},x:{ticks:{maxTicksLimit:8}}},layout:{padding:0}}},d=document.getElementsByClassName("burst-chartjs-stats");null!=window.insightsGraph&&window.insightsGraph.destroy(),window.insightsGraph=new Chart(d,l);let u=JSON.parse(t("input[name=burst_chartjs_metrics]").val());t.ajax({type:"get",dataType:"json",url:burst.ajaxurl,data:{action:"burst_get_chart_statistics",date_start:e,date_end:s,metrics:u,date_range:a},success:function(t){if(1==t.success){let a=0;t.data.datasets.forEach((function(t){if(l.data.datasets.hasOwnProperty(a))l.data.datasets[a]=t;else{let a=t;l.data.datasets.push(a)}a++})),l.data.labels=t.data.labels,o.dates=t.data.dates,window.insightsGraph.update()}else alert("Your data could not be loaded")},error:function(t){console.log(t)}})}function s(){t(".burst-load-ajax").each((function(){let e=t(this);0===e.find(".burst-skeleton").length&&e.find(".burst-grid-content").fadeOut(200,(function(){t(this).html('<div class="burst-skeleton"></div>').fadeIn(300)}));let s=e.data("block_type"),r=parseInt(t("input[name=burst_date_start]").val()),n=parseInt(t("input[name=burst_date_end]").val());t.ajax({type:"get",dataType:"json",url:burst.ajaxurl,data:{action:"burst_load_grid_block",type:s,date_start:r,date_end:n,date_range:a},success:function(a){a.success&&e.find(".burst-grid-content").fadeOut(300,(function(){t(this).html(a.html).fadeIn(200)}))}})}))}function r(a,e){burstLocalizeString("date_format"),t(".burst-date-container span").html(a.format("MMMM D, YYYY")+" - "+e.format("MMMM D, YYYY"))}!function(){let n=moment().endOf("day").subtract(2,"days").add(1,"minutes"),i=moment().endOf("day").subtract(1,"days"),o=burstLocalizeString("Yesterday"),l=burstLocalizeString("Last 7 days"),d=burstLocalizeString("Last 30 days"),u=burstLocalizeString("Last 90 days"),c=burstLocalizeString("Last Month")+" ("+moment().subtract(1,"month").format("MMMM")+")",b={};b[o]=[n,i],b[l]=[moment(i).subtract(6,"days").startOf("day"),i],b[d]=[moment(i).subtract(29,"days").startOf("day"),i],b[u]=[moment(i).subtract(89,"days").startOf("day"),i],b[c]=[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")];let g=moment(i).subtract(6,"days").startOf("day"),f=i;t(".burst-compare-days-number").html(Math.abs(g.diff(f,"days"))+1),r(g,f);let m=g.unix()+60*g.utcOffset(),p=f.unix()+60*f.utcOffset();t("input[name=burst_date_start]").val(m),t("input[name=burst_date_end]").val(p),s(),e(),t(".burst-date-container.burst-date-range").daterangepicker({ranges:b,locale:{format:burstLocalizeString("date_format"),separator:" - ",applyLabel:burstLocalizeString("Apply"),cancelLabel:burstLocalizeString("Cancel"),fromLabel:burstLocalizeString("From"),toLabel:burstLocalizeString("To"),customRangeLabel:burstLocalizeString("Custom"),weekLabel:burstLocalizeString("W"),daysOfWeek:[burstLocalizeString("Su"),burstLocalizeString("Mo"),burstLocalizeString("Tu"),burstLocalizeString("We"),burstLocalizeString("Th"),burstLocalizeString("Fr"),burstLocalizeString("Sa")],monthNames:[burstLocalizeString("January"),burstLocalizeString("February"),burstLocalizeString("March"),burstLocalizeString("April"),burstLocalizeString("May"),burstLocalizeString("June"),burstLocalizeString("July"),burstLocalizeString("August"),burstLocalizeString("September"),burstLocalizeString("October"),burstLocalizeString("November"),burstLocalizeString("December")],firstDay:1},alwaysShowCalendars:!0,startDate:g,endDate:f,opens:"left",maxDate:i},(function(n,i,o){a=burst_unLocalizeString(o),r(n,i);let l=n.unix()+60*n.utcOffset(),d=i.unix()+60*i.utcOffset();t("input[name=burst_date_start]").val(l),t("input[name=burst_date_end]").val(d),e(),t(".burst-compare-days-number").html(Math.abs(n.diff(i,"days"))+1),s(),window.burstLoadAjaxTables()}))}();let n=0;function i(e,s,r,o){1===r&&e.html(burst.skeleton);let l=parseInt(t("input[name=burst_date_start]").val()),d=parseInt(t("input[name=burst_date_end]").val()),u=e.data("block_type");t.ajax({type:"GET",url:burst.ajaxurl,dataType:"json",data:{action:"burst_get_datatable",start:l,end:d,page:r,type:u,date_range:a},success:function(a){if(1===r){let r=e.find("table");e.find(".burst-skeleton").fadeOut(300,(function(){r.hide().html(a.html).fadeIn(200),r.DataTable().destroy(),e.find(".dataTables_filter").remove(),e.find(".dataTables_paginate").remove(),e.find(".dataTables_length").remove(),function(a,e){a.DataTable({id:e,pageLength:10,pagingType:"simple_numbers",conditionalPaging:!0,autoWidth:!0,info:!1,lengthChange:!0,language:{paginate:{previous:burstLocalizeString("Previous"),next:burstLocalizeString("Next")},sLengthMenu:"_MENU_",searchPlaceholder:burstLocalizeString("Search"),search:"",zeroRecords:burstLocalizeString("No matching records found"),emptyTable:burstLocalizeString("No data found")},order:[[1,"desc"]]}),a.on("page.dt",(function(){let a=t(this).closest("table").DataTable().page.info();n=a.page}))}(r,s),e.find(".dataTables_filter").appendTo(e.find(".burst-grid-controls")),e.find(".dataTables_paginate").appendTo(e.find(".burst-grid-footer")),e.find(".dataTables_length").appendTo(e.find(".burst-grid-footer")),e.find(".burst-datatable").css("display","block")}))}else{let s=e.find("table").DataTable(),r=a.html.length;for(let e in a.html)if(a.html.hasOwnProperty(e)){let i=t(a.html[e]);parseInt(e)>=r-1?(s.row.add(i).draw(),s.page(n).draw(!1)):s.row.add(i)}}o+=a.batch,a.total_rows>o?(r++,i(e,r,o)):r=1}})}t.fn.DataTable.ext.pager.numbers_length=5,t(window).on("resize",(function(){t(".burst-grid-container").each((function(){t(this).hasClass("burst-load-ajax-datatable")&&t(this).find("table").DataTable().columns.adjust().draw()}))})),window.burstLoadAjaxTables=function(){t(".burst-grid-datatable").each((function(){let a=t(this).find(".burst-skeleton");"none"===a.css("display")&&t(this).find(".burst-datatable").fadeOut(200,(function(){a.fadeIn(300)})),i(t(this),t(this).data("id"),1,0)}))},window.burstLoadAjaxTables()}));
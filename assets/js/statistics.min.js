jQuery(document).ready((function(t){"use strict";function a(a,e){a=void 0!==a?a:parseInt(t("input[name=burst_date_start]").val()),e=void 0!==e?e:parseInt(t("input[name=burst_date_end]").val());let n=getComputedStyle(document.body),r=n.getPropertyValue("--rsp-blue"),s=n.getPropertyValue("--rsp-yellow"),i={type:"line",beginAtZero:!0,data:{datasets:[{label:"Pageviews",borderColor:r,backgroundColor:r},{label:"Visitors",borderColor:s,backgroundColor:s}]},options:{responsive:!0,maintainAspectRatio:!1,cubicInterpolationMode:"monotone",scales:{y:{ticks:{beginAtZero:!0,stepSize:1,maxTicksLimit:6}},x:{ticks:{maxTicksLimit:8}}}}},o=document.getElementsByClassName("burst-chartjs-stats");null!=window.insightsGraph&&window.insightsGraph.destroy(),window.insightsGraph=new Chart(o,i);let u=JSON.parse(t("input[name=burst_chartjs_metrics]").val());t.ajax({type:"get",dataType:"json",url:burst.ajaxurl,data:{action:"burst_get_chart_statistics",date_start:a,date_end:e,metrics:u},success:function(t){if(1==t.success){let a=0;console.log(t.data),console.log(i),t.data.datasets.forEach((function(t){if(i.data.datasets.hasOwnProperty(a))i.data.datasets[a]=t;else{let a=t;i.data.datasets.push(a)}a++})),i.data.labels=t.data.labels,i.data.dates=t.data.dates,console.log(i),window.insightsGraph.update()}else alert("Your data could not be loaded")},error:function(t){console.log(t)}})}function e(){t(".burst-load-ajax").each((function(){let a=t(this);0==a.find(".burst-skeleton").length&&a.find(".burst-grid-content").fadeOut(200,(function(){t(this).html('<div class="burst-skeleton"></div>').fadeIn(300)}));let e=a.data("block_type"),n=parseInt(t("input[name=burst_date_start]").val()),r=parseInt(t("input[name=burst_date_end]").val());t.ajax({type:"get",dataType:"json",url:burst.ajaxurl,data:{action:"burst_load_grid_block",type:e,date_start:n,date_end:r},success:function(e){e.success&&a.find(".burst-grid-content").fadeOut(300,(function(){t(this).html(e.html).fadeIn(200)}))}})}))}function n(a,e){t(".burst-date-container span").html(a.format("MMMM D, YYYY")+" - "+e.format("MMMM D, YYYY"))}!function(){moment().endOf("day").subtract(1,"days").add(1,"minutes");let r=moment().endOf("day"),s=moment().endOf("day").subtract(2,"days").add(1,"minutes"),i=moment().endOf("day").subtract(1,"days"),o=burstLocalizeString("Yesterday"),u=burstLocalizeString("Previous 7 days"),l=burstLocalizeString("Previous 30 days"),d=burstLocalizeString("Previous 90 days"),b=burstLocalizeString("Previous Month")+" ("+moment().subtract(1,"month").format("MMMM")+")",c={};c[o]=[s,i],c[u]=[moment().subtract(8,"days"),i],c[l]=[moment().subtract(32,"days"),i],c[d]=[moment().subtract(92,"days"),i],c[b]=[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")];let m=parseInt(t("input[name=burst_date_start]").val()),g=parseInt(t("input[name=burst_date_end]").val());null!==m&&null!==g||(m=moment().endOf("day").subtract(8,"days").unix(),g=moment().endOf("day").subtract(1,"day").unix());m=parseInt(m),g=parseInt(g),n(moment.unix(m),moment.unix(g)),a(),t(".burst-date-container.burst-date-range").daterangepicker({ranges:c,locale:{format:burstLocalizeString("date_format","burst"),separator:" - ",applyLabel:burstLocalizeString("Apply","burst"),cancelLabel:burstLocalizeString("Cancel","burst"),fromLabel:burstLocalizeString("From","burst"),toLabel:burstLocalizeString("To","burst"),customRangeLabel:burstLocalizeString("Custom","burst"),weekLabel:burstLocalizeString("W","burst"),daysOfWeek:[burstLocalizeString("Su","burst"),burstLocalizeString("Mo","burst"),burstLocalizeString("Tu","burst"),burstLocalizeString("We","burst"),burstLocalizeString("Th","burst"),burstLocalizeString("Fr","burst"),burstLocalizeString("Sa","burst")],monthNames:[burstLocalizeString("January"),burstLocalizeString("February"),burstLocalizeString("March"),burstLocalizeString("April"),burstLocalizeString("May"),burstLocalizeString("June"),burstLocalizeString("July"),burstLocalizeString("August"),burstLocalizeString("September"),burstLocalizeString("October"),burstLocalizeString("November"),burstLocalizeString("December")],firstDay:1},alwaysShowCalendars:!0,startDate:moment.unix(m),endDate:moment.unix(g),opens:"left",maxDate:r},(function(r,s,i){n(r,s),a(r.unix(),s.unix()),t("input[name=burst_date_start]").val(r.unix()),t("input[name=burst_date_end]").val(s.unix()),e(),window.burstLoadAjaxTables()}))}(),t(document).on("change","select[name=burst_selected_metric]",(function(){let e=t(".burst-date-container.burst-date-range").data("daterangepicker"),n=moment(e.startDate),r=moment(e.endDate);a(n.unix(),r.unix())})),e();let r=0;t.fn.DataTable.ext.pager.numbers_length=5,t(window).on("resize",(function(){t(".burst-grid-container").each((function(){t(this).hasClass("burst-load-ajax-datatable")&&t(this).find("table").DataTable().columns.adjust().draw()}))})),window.burstLoadAjaxTables=function(){t(".burst-grid-datatable").each((function(){0==t(this).find(".burst-skeleton").length&&t(this).find(".burst-grid-content").fadeOut(200,(function(){t(this).html('<div class="burst-skeleton"></div>').fadeIn(300)})),s(t(this),t(this).data("id"),1,0)}))},window.burstLoadAjaxTables();array();function s(a,e,n,i){1===n&&a.html(burst.skeleton);let o=parseInt(t("input[name=burst_date_start]").val()),u=parseInt(t("input[name=burst_date_end]").val()),l=a.data("block_type");t.ajax({type:"GET",url:burst.ajaxurl,dataType:"json",data:{action:"burst_get_datatable",start:o,end:u,page:n,type:l},success:function(o){if(1===n){let n=a.find("table");a.find(".burst-skeleton").fadeOut(300,(function(){n.hide().html(o.html).fadeIn(200),n.DataTable().destroy(),a.find(".dataTables_filter").remove(),a.find(".dataTables_paginate").remove(),function(a,e){t(window),a.DataTable({id:e,pageLength:10,pagingType:"simple_numbers",conditionalPaging:!0,autoWidth:!0,info:!1,lengthChange:!1,language:{paginate:{previous:burstLocalizeString("Previous"),next:burstLocalizeString("Next")},searchPlaceholder:burstLocalizeString("Search"),search:"",emptyTable:burstLocalizeString("No data available")},order:[[1,"desc"]]}),a.on("page.dt",(function(){let a=t(this).closest("table").DataTable().page.info();r=a.page}))}(n,e),a.find(".dataTables_filter").appendTo(a.find(".burst-grid-controls")),a.find(".dataTables_paginate").appendTo(a.find(".burst-grid-footer"))}))}else{let e=a.find("table").DataTable(),n=o.html.length;for(let a in o.html)if(o.html.hasOwnProperty(a)){let s=t(o.html[a]);parseInt(a)>=n-1?(e.row.add(s).draw(),e.page(r).draw(!1)):e.row.add(s)}}i+=o.batch,o.total_rows>i?(n++,s(a,n,i)):n=1}})}}));